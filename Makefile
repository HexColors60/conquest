# Generated automatically from Makefile.in by configure.
# Makefile for conquest - generated by configure from Makefile.in
#
#
# Jon Trulson
#
# $Id$
#
###########################################################################

# User defineable options
CONQBIN = /opt/bin
CONQHOME = /opt/conquest


# Unixware: try -Ki486 or -Kpentium -
#  might improve performance depending on processor type.
#LCFLAGS = -Kpentium

LCFLAGS = 


CFLAGS =  -O -Xa -DHAVE_CONFIG_H $(LCFLAGS) -DCONQHOME=\"$(CONQHOME)\"
CONQUEST = conquest
CONQAI = conqai
CONQOPER = conqoper
CONQDRIV = conqdriv
CONQSTRAT = conqstrat

# The documentation
CONQHELP = conquest.doc
CONQNEWS = conqnews.doc

CURDIR=.
CONQC = conqfig.c ratfor.c cd2lb.c ionlb.c ioxlb.c \
	conqlb.c gamlb.c ioplb.c rndlb.c conqmisc.c conqutil.c conqcm.c \
	conqsvr42.c global.c ibuf.c version.c conf.c sem.c

CONQOBJS = conqfig.o ratfor.o cd2lb.o ionlb.o ioxlb.o \
	conqlb.o gamlb.o ioplb.o rndlb.o conqmisc.o conqutil.o conqcm.o \
	conqsvr42.o global.o ibuf.o version.o conf.o sem.o

# For installation
BCONQUEST = $(CONQHOME)/bin/conquest
BCONQOPER = $(CONQHOME)/bin/conqoper
BCONQDRIV = $(CONQHOME)/bin/conqdriv
BCONQAI = $(CONQHOME)/bin/conqai
BCONQSTRAT = $(CONQHOME)/bin/conqstrat
HCONQHELP = $(CONQHOME)/etc/$(CONQHELP)
HCONQNEWS = $(CONQHOME)/etc/$(CONQNEWS)

CONQLB = libconquest.so

EXTLBS = -lcurses -lm  -ll -ly

LEX = lex
YACC = yacc

# [shared|static] lib build options
LBFLAGS =  -G $(CFLAGS) -o $(CONQLB)

# End of config options - No user servicable parts inside.
default:
	@echo "type gmake <target>, where <target> is:"
	@echo ""
	@echo "all	- make all the binaries"
	@echo "install	- to install the binaries (must be root)"
	@echo "clean	- to remove all .o's, libs, and binaries"
	@echo "depend	- to make a dependancy list for your makefile."
	@echo "           Use 'gmake clean' before building if you are"
	@echo "           lacking a 'makedepend' command."

all: $(CONQLB) $(CONQUEST) $(CONQOPER) $(CONQAI) $(CONQDRIV) $(CONQSTRAT)

# program building  
##################

conquest: conquest.o 
	@-rm -f conquest
	$(CC) -o conquest $(CFLAGS) conquest.o $(CURDIR)/$(CONQLB) $(EXTLBS)
	@chgrp conquest conquest
	@chmod 2771 conquest

conquest.o: conquest.c c_defs.h defs.h conqdef.h conqcom.h conqcom2.h
	$(CC) $(CFLAGS) -c conquest.c

conqdriv.o: conqdriv.c c_defs.h defs.h conqdef.h conqcom.h conqcom2.h
	$(CC) $(CFLAGS) -c conqdriv.c

conqdriv: conqdriv.o 
	@-rm -f conqdriv
	$(CC) -o conqdriv $(CFLAGS) conqdriv.o $(CURDIR)/$(CONQLB) $(EXTLBS)
	@chgrp conquest conqdriv
	@chmod 2771 conqdriv

conqai: conqai.o 
	@-rm -f conqai
	$(CC) -o conqai $(CFLAGS) conqai.o $(CURDIR)/$(CONQLB) $(EXTLBS)
	@chgrp conquest conqai
	@chmod 2771 conqai

conqai.o: conqai.c c_defs.h defs.h conqdef.h conqcom.h conqcom2.h conqdata.h
	$(CC) $(CFLAGS) -c -DCONQAIMAIN conqai.c 

conqai_nomain.o: conqai.c c_defs.h defs.h conqdef.h conqcom.h conqcom2.h conqdata.h
	$(CC) $(CFLAGS) -c conqai.c
	mv conqai.o conqai_nomain.o 

conqoper: conqoper.o 
	@-rm -f conqoper
	$(CC) -o conqoper $(CFLAGS) conqoper.o $(CURDIR)/$(CONQLB) $(EXTLBS)
	@chgrp conquest conqoper
	@chmod 2771 conqoper

conqoper.o: conqoper.c c_defs.h defs.h conqdef.h conqcom.h conqcom2.h
	$(CC) $(CFLAGS) -c conqoper.c 

# we won't die if the following fails, since a default conqdata.h is supplied
conqstrat:  y.tab.o lex.yy.o
	-$(CC) -o conqstrat $(CFLAGS) lex.yy.o y.tab.o $(LIBS) $(CURDIR)/$(CONQLB) $(EXTLBS)

y.tab.c: conqstrat.c.y
	-$(YACC) -d conqstrat.c.y

y.tab.o: y.tab.c

lex.yy.c: conqstrat.c.l
	-$(LEX) conqstrat.c.l

lex.yy.o: lex.yy.c
 
# library building 
################

LBBUILD = $(CC)

$(CONQLB): conqai_nomain.o $(CONQOBJS)
	$(LBBUILD) $(LBFLAGS) conqai_nomain.o $(CONQOBJS)
	echo $(CONQLB)

# Install it!
#############################

install: all $(CONQHOME) $(CONQHOME)/etc $(CONQHOME)/bin $(CONQHOME)/lib \
	$(CONQHOME)/lib/$(CONQLB) $(BCONQUEST) $(BCONQOPER) $(BCONQDRIV)  \
	$(HCONQHELP) $(HCONQNEWS) $(CONQHOME)/lib/$(CONQLB) /opt \
	$(CONQBIN) $(CONQHOME)/etc/conqrule $(BCONQSTRAT) \
	$(CONQHOME)/etc/conquestrc 

$(CONQHOME)/lib/$(CONQLB): $(CONQLB)
	cp $(CONQLB) $(CONQHOME)/lib/$(CONQLB)
	chgrp conquest $(CONQHOME)/lib/$(CONQLB)
	chmod 644 $(CONQHOME)/lib/$(CONQLB)

$(CONQHOME):
	mkdir -p $(CONQHOME)
	chmod 775 $(CONQHOME)
	chgrp conquest $(CONQHOME)
	
$(CONQHOME)/etc:
	mkdir -p $(CONQHOME)/etc
	chmod 775 $(CONQHOME)/etc
	chgrp conquest $(CONQHOME)/etc
	
$(CONQHOME)/bin:
	mkdir -p $(CONQHOME)/bin
	chmod 775 $(CONQHOME)/bin
	chgrp conquest $(CONQHOME)/bin
	
$(CONQHOME)/lib:
	mkdir -p $(CONQHOME)/lib
	chmod 775 $(CONQHOME)/lib
	chgrp conquest $(CONQHOME)/lib
	
/opt:
	mkdir -p /opt
	chmod 775 /opt
	chgrp conquest /opt

$(CONQBIN):
	mkdir -p $(CONQBIN)
	chmod 775 $(CONQBIN)
	chgrp conquest $(CONQBIN)

$(CONQHOME)/etc/conquestrc: $(BCONQOPER)
	$(BCONQOPER) -C
	chmod 664 $(CONQHOME)/etc/conquestrc
	chgrp conquest $(CONQHOME)/etc/conquestrc

$(BCONQUEST): conquest
	@-rm -f $(BCONQUEST)
	$(CC) -o conquest $(CFLAGS) conquest.o $(CONQHOME)/lib/$(CONQLB) $(EXTLBS)
	cp conquest $(BCONQUEST)
	chgrp conquest $(BCONQUEST)
	chmod 2771 $(BCONQUEST)
	/sbin/filepriv -f plock,tshar,core $(BCONQUEST)
	@-ln -s $(BCONQUEST) $(CONQBIN)/conquest

$(BCONQOPER): conqoper
	@-rm -f $(BCONQOPER)
	$(CC) -o conqoper $(CFLAGS) conqoper.o $(CONQHOME)/lib/$(CONQLB) $(EXTLBS)
	cp conqoper $(BCONQOPER)
	chgrp conquest $(BCONQOPER)
	chmod 2771 $(BCONQOPER)
	/sbin/filepriv -f plock,tshar,core $(BCONQOPER)
	@-ln -s $(BCONQOPER) $(CONQBIN)/conqoper
	
$(BCONQDRIV): conqdriv
	@-rm -f $(BCONQDRIV)
	$(CC) -o conqdriv $(CFLAGS) conqdriv.o $(CONQHOME)/lib/$(CONQLB) $(EXTLBS)
	cp conqdriv $(BCONQDRIV)
	chgrp conquest $(BCONQDRIV)
	chmod 2771 $(BCONQDRIV)
	/sbin/filepriv -f plock,tshar,core $(BCONQDRIV)
	@-ln -s $(BCONQDRIV) $(CONQBIN)/conqdriv
	
$(BCONQAI): conqai
	@-rm -f $(BCONQAI)
	$(CC) -o conqai $(CFLAGS) conqai.o $(CONQHOME)/lib/$(CONQLB) $(EXTLBS)
	cp conqai $(BCONQAI)
	chgrp conquest $(BCONQAI)
	chmod 2771 $(BCONQAI)
	/sbin/filepriv -f plock,tshar,core $(BCONQAI)	
	@-ln -s $(BCONQAI) $(CONQBIN)/conqai

$(BCONQSTRAT): conqstrat
	@-rm -f $(BCONQSTRAT)
	-$(CC) -o conqstrat $(CFLAGS) lex.yy.o y.tab.o $(LIBS) $(CONQHOME)/lib/$(CONQLB) $(EXTLBS)
	cp conqstrat $(BCONQSTRAT)
	chgrp conquest $(BCONQSTRAT)
	chmod 755 $(BCONQSTRAT)
	@-ln -s $(BCONQSTRAT) $(CONQBIN)/conqstrat

$(CONQHOME)/etc/conqrule: conqrule
	cp conqrule $(CONQHOME)/etc/conqrule
	chgrp conquest $(CONQHOME)/etc/conqrule
	chmod 644 $(CONQHOME)/etc/conqrule

$(HCONQHELP): $(CONQHELP)
	cp $(CONQHELP) $(HCONQHELP)
	chgrp conquest $(HCONQHELP)
	chmod 644 $(HCONQHELP)

$(HCONQNEWS): $(CONQNEWS)
	cp $(CONQNEWS) $(HCONQNEWS)
	chgrp conquest $(HCONQNEWS)
	chmod 644 $(HCONQNEWS)

clean:
	rm -f *.o $(CONQUEST) $(CONQOPER) $(CONQAI) $(CONQDRIV) \
		$(CONQLB) $(CONQSTRAT) y.tab.[ch] lex.yy.[c]

depend: 
	makedepend -s "# DO NOT DELETE - MAKEDEPEND" -- *.h -- *.c >/dev/null 2>&1


