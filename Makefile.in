# Makefile for conquest - generated by configure from Makefile.in
#
#
# Jon Trulson
#
# $Id$
#
###########################################################################

# User defineable options
CONQBIN = @prefix@/bin
CONQHOME = @prefix@/conquest
MAKE = make

# Unixware: try -Ki486 or -Kpentium -
#  might improve performance depending on processor type.
#LCFLAGS = -Kpentium

LCFLAGS = 


CFLAGS = @CFLAGS@ @DEFS@ $(LCFLAGS) -DCONQHOME=\"$(CONQHOME)\"
CONQUEST = conquest
CONQAI = conqai
CONQOPER = conqoper
CONQDRIV = conqdriv
CONQSTRAT = conqstrat

# The documentation
CONQHELP = conquest.doc
CONQNEWS = conqnews.doc

CURDIR=.
CONQC = ratfor.c cd2lb.c display.c iolb.c  \
	conqlb.c rndlb.c conqmisc.c conqutil.c conqcm.c \
	conqsvr42.c global.c ibuf.c version.c conf.c sem.c color.c \
	userauth.c

CONQOBJS = ratfor.o cd2lb.o display.o iolb.o  \
	conqlb.o rndlb.o conqmisc.o conqutil.o conqcm.o \
	conqsvr42.o global.o ibuf.o version.o conf.o sem.o color.o \
	userauth.o

# For installation
BCONQUEST = $(CONQHOME)/bin/conquest
BCONQOPER = $(CONQHOME)/bin/conqoper
BCONQDRIV = $(CONQHOME)/bin/conqdriv
BCONQAI = $(CONQHOME)/bin/conqai
BCONQSTRAT = $(CONQHOME)/bin/conqstrat
HCONQHELP = $(CONQHOME)/etc/$(CONQHELP)
HCONQNEWS = $(CONQHOME)/etc/$(CONQNEWS)
HCONQREADME = $(CONQHOME)/etc/README

CONQLB = @CONQLB@

EXTLBS = @LIBS@ @LEXLIB@ @YACCLIB@

LEX = @LEX@
YACC = @YACC@

# [shared|static] lib build options
LBFLAGS = @LBFLAGS@

# End of config options - No user servicable parts inside.
default:
	@echo "type gmake <target>, where <target> is:"
	@echo ""
	@echo "all        - make all the binaries"
	@echo "install    - to install the binaries (must be root)"
	@echo "clean      - to remove all .o's, libs, and binaries"
	@echo "realclean  - like clean, but removes configure genned files too"
	@echo "depend     - to make a dependancy list for your makefile."
	@echo "             Use 'gmake clean' before building if you are"
	@echo "             lacking a 'makedepend' command."

all: $(CONQLB) $(CONQUEST) $(CONQOPER) $(CONQAI) $(CONQDRIV) $(CONQSTRAT)

# program building  
##################

conquest: conquest.o 
	@-rm -f conquest
	$(CC) -o conquest $(CFLAGS) conquest.o $(CURDIR)/$(CONQLB) $(EXTLBS)
	@chgrp conquest conquest
	@chmod 2771 conquest

conquest.o: conquest.c c_defs.h defs.h conqdef.h conqcom.h conqcom2.h
	$(CC) $(CFLAGS) -c conquest.c

conqdriv.o: conqdriv.c c_defs.h defs.h conqdef.h conqcom.h conqcom2.h
	$(CC) $(CFLAGS) -c conqdriv.c

conqdriv: conqdriv.o 
	@-rm -f conqdriv
	$(CC) -o conqdriv $(CFLAGS) conqdriv.o $(CURDIR)/$(CONQLB) $(EXTLBS)
	@chgrp conquest conqdriv
	@chmod 2771 conqdriv

conqai: conqai.o 
	@-rm -f conqai
	$(CC) -o conqai $(CFLAGS) conqai.o $(CURDIR)/$(CONQLB) $(EXTLBS)
	@chgrp conquest conqai
	@chmod 2771 conqai

conqai.o: conqai.c c_defs.h defs.h conqdef.h conqcom.h conqcom2.h conqdata.h
	$(CC) $(CFLAGS) -c -DCONQAIMAIN conqai.c 

conqai_nomain.o: conqai.c c_defs.h defs.h conqdef.h conqcom.h conqcom2.h conqdata.h
	$(CC) $(CFLAGS) -c conqai.c
	mv conqai.o conqai_nomain.o 

conqoper: conqoper.o 
	@-rm -f conqoper
	$(CC) -o conqoper $(CFLAGS) conqoper.o $(CURDIR)/$(CONQLB) $(EXTLBS)
	@chgrp conquest conqoper
	@chmod 2771 conqoper

conqoper.o: conqoper.c c_defs.h defs.h conqdef.h conqcom.h conqcom2.h
	$(CC) $(CFLAGS) -c conqoper.c 

# we won't die if the following fails, since a default conqdata.h is supplied
conqstrat:  y.tab.o lex.yy.o
	-$(CC) -o conqstrat $(CFLAGS) lex.yy.o y.tab.o $(LIBS) $(CURDIR)/$(CONQLB) $(EXTLBS)

y.tab.c: conqstrat.c.y
	-$(YACC) -d conqstrat.c.y

y.tab.o: y.tab.c

lex.yy.c: conqstrat.c.l
	-$(LEX) conqstrat.c.l

lex.yy.o: lex.yy.c
 
# library building 
################

LBBUILD = @LBBUILD@

$(CONQLB): conqai_nomain.o $(CONQOBJS)
	$(LBBUILD) $(LBFLAGS) conqai_nomain.o $(CONQOBJS)
	@RANLIB@ $(CONQLB)

# Install it!
#############################

install: all $(CONQHOME) $(CONQHOME)/etc $(CONQHOME)/bin $(CONQHOME)/lib \
	$(CONQHOME)/lib/$(CONQLB) $(BCONQUEST) $(BCONQOPER) $(BCONQDRIV)  \
	$(HCONQHELP) $(HCONQNEWS) $(CONQHOME)/lib/$(CONQLB) @prefix@ \
	$(CONQBIN) $(CONQHOME)/etc/conqrule $(BCONQSTRAT) $(BCONQAI) \
	$(CONQHOME)/etc/conquestrc $(CONQBIN)/conquest $(CONQBIN)/conqoper \
	$(CONQBIN)/conqstrat $(CONQBIN)/conqdriv $(CONQBIN)/conqai \
	$(HCONQREADME)

@prefix@:
	mkdir -p @prefix@
	chmod 775 @prefix@
	chgrp conquest @prefix@

$(CONQBIN):
	mkdir -p $(CONQBIN)
	chmod 775 $(CONQBIN)

$(CONQBIN)/conquest: $(BCONQUEST)
	@-rm -f $(CONQBIN)/conquest
	@-ln -s $(BCONQUEST) $(CONQBIN)/conquest

$(CONQBIN)/conqoper: $(BCONQOPER)
	@-rm -f $(CONQBIN)/conqoper
	@-ln -s $(BCONQOPER) $(CONQBIN)/conqoper

$(CONQBIN)/conqdriv: $(BCONQDRIV)
	@-rm -f $(CONQBIN)/conqdriv
	@-ln -s $(BCONQDRIV) $(CONQBIN)/conqdriv

$(CONQBIN)/conqstrat: $(BCONQSTRAT)
	@-rm -f $(CONQBIN)/conqstrat
	@-ln -s $(BCONQSTRAT) $(CONQBIN)/conqstrat

$(CONQBIN)/conqai: $(BCONQAI)
	@-rm -f $(CONQBIN)/conqai
	@-ln -s $(BCONQAI) $(CONQBIN)/conqai

$(CONQHOME):
	mkdir -p $(CONQHOME)
	chmod 775 $(CONQHOME)
	chgrp conquest $(CONQHOME)

$(CONQHOME)/lib/$(CONQLB): $(CONQLB)
	cp $(CONQLB) $(CONQHOME)/lib/$(CONQLB)
	chgrp conquest $(CONQHOME)/lib/$(CONQLB)
	chmod 644 $(CONQHOME)/lib/$(CONQLB)

$(CONQHOME)/etc:
	mkdir -p $(CONQHOME)/etc
	chmod 775 $(CONQHOME)/etc
	chgrp conquest $(CONQHOME)/etc

$(CONQHOME)/bin:
	mkdir -p $(CONQHOME)/bin
	chmod 775 $(CONQHOME)/bin
	chgrp conquest $(CONQHOME)/bin

$(CONQHOME)/lib:
	mkdir -p $(CONQHOME)/lib
	chmod 775 $(CONQHOME)/lib
	chgrp conquest $(CONQHOME)/lib

$(CONQHOME)/etc/conquestrc: $(BCONQOPER)
	$(BCONQOPER) -C
	chmod 664 $(CONQHOME)/etc/conquestrc
	chgrp conquest $(CONQHOME)/etc/conquestrc

$(BCONQUEST): conquest
	@-rm -f $(BCONQUEST)
	$(CC) -o conquest $(CFLAGS) conquest.o $(CONQHOME)/lib/$(CONQLB) $(EXTLBS)
	cp conquest $(BCONQUEST)
	chgrp conquest $(BCONQUEST)
	chmod 2771 $(BCONQUEST)
	@FILEPRIV@ -f plock,tshar,core $(BCONQUEST)

$(BCONQOPER): conqoper
	@-rm -f $(BCONQOPER)
	$(CC) -o conqoper $(CFLAGS) conqoper.o $(CONQHOME)/lib/$(CONQLB) $(EXTLBS)
	cp conqoper $(BCONQOPER)
	chgrp conquest $(BCONQOPER)
	chmod 2771 $(BCONQOPER)
	@FILEPRIV@ -f plock,tshar,core $(BCONQOPER)

$(BCONQDRIV): conqdriv
	@-rm -f $(BCONQDRIV)
	$(CC) -o conqdriv $(CFLAGS) conqdriv.o $(CONQHOME)/lib/$(CONQLB) $(EXTLBS)
	cp conqdriv $(BCONQDRIV)
	chgrp conquest $(BCONQDRIV)
	chmod 2771 $(BCONQDRIV)
	@FILEPRIV@ -f plock,tshar,core $(BCONQDRIV)

$(BCONQAI): conqai
	@-rm -f $(BCONQAI)
	$(CC) -o conqai $(CFLAGS) conqai.o $(CONQHOME)/lib/$(CONQLB) $(EXTLBS)
	cp conqai $(BCONQAI)
	chgrp conquest $(BCONQAI)
	chmod 2770 $(BCONQAI)
	@FILEPRIV@ -f plock,tshar,core $(BCONQAI)	

$(BCONQSTRAT): conqstrat
	@-rm -f $(BCONQSTRAT)
	-$(CC) -o conqstrat $(CFLAGS) lex.yy.o y.tab.o $(LIBS) $(CONQHOME)/lib/$(CONQLB) $(EXTLBS)
	cp conqstrat $(BCONQSTRAT)
	chgrp conquest $(BCONQSTRAT)
	chmod 751 $(BCONQSTRAT)

$(CONQHOME)/etc/conqrule: conqrule
	cp conqrule $(CONQHOME)/etc/conqrule
	chgrp conquest $(CONQHOME)/etc/conqrule
	chmod 644 $(CONQHOME)/etc/conqrule

$(HCONQREADME): README
	cp README $(HCONQREADME)
	chgrp conquest $(HCONQREADME)
	chmod 644 $(HCONQREADME)

$(HCONQHELP): $(CONQHELP)
	cp $(CONQHELP) $(HCONQHELP)
	chgrp conquest $(HCONQHELP)
	chmod 644 $(HCONQHELP)

$(HCONQNEWS): $(CONQNEWS)
	cp $(CONQNEWS) $(HCONQNEWS)
	chgrp conquest $(HCONQNEWS)
	chmod 644 $(HCONQNEWS)

clean:
	rm -f *.o $(CONQUEST) $(CONQOPER) $(CONQAI) $(CONQDRIV) \
		$(CONQLB) $(CONQSTRAT) y.tab.[ch] lex.yy.[c]

realclean:
	$(MAKE) clean
	rm -f config.status config.cache Makefile config.h

depend: 
	makedepend -s "# DO NOT DELETE - MAKEDEPEND" -- *.h -- *.c >/dev/null 2>&1


